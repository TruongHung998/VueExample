import{defineComponent as e,inject as t,getCurrentInstance as n,ref as i,computed as o,watch as s,onMounted as r,openBlock as a,createBlock as u,resolveDynamicComponent as c,mergeProps as l}from"vue";const d="Disqus shortname is required. (To resolve this, go to: https://ktquez.github.io/vue-disqus/setup.html#installation)",g=["api_key","author_s3","category_id","identifier","integration","language","remote_auth_s3","slug","title","url"],f=["name","button","icon","url","logout","width","height"],p=["afterRender","onInit","onIdentify","beforeComment","onNewComment","onPaginate","onReady","preData","preInit","preReset"],m=Symbol("disqus"),h=e=>requestAnimationFrame((()=>requestAnimationFrame(e)));var y=e({name:"Disqus",props:{shortname:String,pageConfig:{type:Object,validator:e=>Object.keys(e).every((e=>g.includes(e)))},ssoConfig:{type:Object,validator:e=>Object.keys(e).every((e=>f.includes(e)))},lang:{type:String,default:"en"},lazy:{type:Boolean,default:!0},lazyConfig:{type:Object,default:()=>({root:null,rootMargin:"300px",threshold:.5})}},setup(e,{emit:a}){const u=t(m),c=n(),l=i(null),g=i(window.location.pathname),f=o((()=>{const t=e.shortname||u.shortname;if(!t)throw new Error(d);return t}));function h(){if(u&&(u.reset=y),window.DISQUS)return y();window.disqus_config=function(){q(this)},function(){const e=+new Date,t=document,n=t.createElement("script");n.setAttribute("id","embed-disqus"),n.setAttribute("data-timestamp",e.toString()),n.type="text/javascript",n.async=!0,n.src=`//${f.value}.disqus.com/embed.js`,(t.head||t.body).appendChild(n)}(),s((()=>g.value),y)}function y(){window.DISQUS.reset({reload:!0,config:function(){q(this)}})}function v(e){e.forEach((e=>{var t;e.isIntersecting&&(null==(t=l.value)||t.disconnect(),h())}))}function q(t){!function(t){const n={url:document.baseURI,identifier:window.location.pathname};Object.assign(t.page,n),e.pageConfig&&Object.keys(e.pageConfig).length&&Object.assign(t.page,e.pageConfig)}(t),function(e){p.forEach((t=>{e.callbacks[t]=[e=>{a(t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().replace("on-",""),e)}]}))}(t),e.ssoConfig&&Object.keys(e.ssoConfig).length&&Object.assign(t.sso,e.ssoConfig),t.language=e.lang}s((()=>e.lang),y),r((()=>{if(e.lazy)return function(){var t;if("IntersectionObserver"in window)return l.value=new IntersectionObserver(v,e.lazyConfig),l.value.observe(null==(t=null==c?void 0:c.proxy)?void 0:t.$el);h()}();h()}))}});const v={id:"disqus_thread",style:{"min-height":"200px"}};y.render=function(e,t){return a(),u("div",v)};var q=e({name:"DisqusCount",props:{url:String,shortname:String,identifier:{type:String,required:!0},tag:{type:String,default:"span"}},setup(e){const n=t(m),a=i(window.location.pathname),u=o((()=>"a"===e.tag?`${e.url}#disqus_thread`:"#")),c=o((()=>"span"===e.tag?e.url:null)),l=o((()=>{const t=e.shortname||n?n.shortname:null;if(!t)throw new Error(d);return t})),g={href:u.value,"data-disqus-url":c.value,"data-disqus-identifier":e.identifier};function f(){window.DISQUSWIDGETS.getCount({reset:!0})}return r((function(){if("DISQUSWIDGETS"in window)return h((()=>f()));(function(){if(document.getElementById("dsq-count-scr"))return;const e=document,t=e.createElement("script");t.async=!0,t.id="dsq-count-scr",t.src=`//${l.value}.disqus.com/count.js`,(e.head||e.body).appendChild(t)})(),s((()=>a.value),(()=>h((()=>f()))))})),{disqusAttrs:g}}});function w(e,t={}){e.component("Disqus",y),e.component("DisqusCount",q);const n={shortname:t.shortname,reset:null};e.provide(m,n)}q.render=function(e,t){return a(),u(c(e.tag),l({class:"disqus-comment-count"},e.disqusAttrs),null,16)};export default w;export{y as Disqus,q as DisqusCount};
